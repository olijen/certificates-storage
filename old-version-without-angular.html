<!DOCTYPE html>
<html>
<head>
	<title></title>
	<style>
		#your-files {
			border: 1px solid #ccc;
		}
	</style>
</head>
<body>

	<div id="your-files">1</div>
	<output id="list"></output>

	<script>
		function cl(t) {console.log(t);}
		var target = document.getElementById("your-files");
		target.addEventListener("dragover", function(event) {
		    event.preventDefault(); // отменяем действие по умолчанию
		}, false);
		target.addEventListener("drop", function(event) {
		    // отменяем действие по умолчанию
		    event.preventDefault();
		    var i = 0,
		    files = event.dataTransfer.files,
		    len = files.length;
		    for (; i < len; i++) {
		    	var file = files[i];
		        console.log("Filename: " + file.name);
		        console.log("Type: " + file.type);
		        console.log("Size: " + file.size + " bytes");

		        var reader = new FileReader();
		      	// Closure to capture the file information.
		      	reader.onload = (function(theFile) {
			        return function(e) {
			        	var result = e.target.result;
			        	console.log(result);
			            alert('File ' + theFile.name + ' load with success');
			            
						var asn1 = ASN1.decode(result);
						
						var oidsValues = getOIDValues(asn1);

						console.log(oidsValues);

						console.log(asn1.content());
			            asn1.toDOM();

			            name = prompt('Введите имя сертификата', theFile.name);
			            window.localStorage.setItem(name, result);
			            
			            //var view  = new Uint8Array(result);
			            //console.log(view);
			        };
		      	}) (file);

		      	reader.onerror = function(event) {
				    console.error("Файл не может быть прочитан! код " + event.target.error.code);
				};
		      	// Read in the image file as a data URL.
		      	//reader.readAsArrayBuffer(file);
		      	reader.readAsBinaryString(file);	
		    }
		}, false);

		function getOIDValues(asn) {
			var oidsValues = [];
			var lastOID = null;

			(function recursive(asn) {
				console.log(asn.typeName() + " >>> " + asn.content());
				
				if (lastOID !== null && asn.getValue() !== false) {
					oidsValues[lastOID] = asn.content();
				}
				if (asn.typeName() === 'OBJECT_IDENTIFIER') {
					if (window.oids[asn.content()] !== undefined) {
						cl(111);
						lastOID = window.oids[asn.content()]['d'];
					}
					else 
						lastOID = asn.content();
				}

				if (asn.sub === null) return;
				for (var i = 0; i < asn.sub.length; i++)
					recursive(asn.sub[i]);
			}) (asn);
		}
	</script>
	<script type="text/javascript" src="oids.js"></script>
	<script type="text/javascript" src="int10.js"></script>
	<script type="text/javascript" src="asn1.js"></script>
	<script type="text/javascript" src="dom.js"></script>
</body>
</html>